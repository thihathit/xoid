/*! For license information please see 6cb13b5c.9a2f7ed7.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{75:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return c})),t.d(n,"rightToc",(function(){return u})),t.d(n,"default",(function(){return s}));var r=t(2),o=t(6),i=(t(95),t(94)),a={id:"dynamic-functions-with-fixed-references",title:"Dynamic functions with fixed references"},c={unversionedId:"recipes/dynamic-functions-with-fixed-references",id:"recipes/dynamic-functions-with-fixed-references",isDocsHomePage:!1,title:"Dynamic functions with fixed references",description:"Inside a React function component, in some cases which will be explained below, a function with a fixed reference, but a dynamic content may be needed. While this is not as straightforward with React hooks, it's trivial with xoid.",source:"@site/../docs/recipes/dynamic-functions-with-fixed-references.md",slug:"/recipes/dynamic-functions-with-fixed-references",permalink:"/docs/recipes/dynamic-functions-with-fixed-references",editUrl:"https://github.com/onurkerimov/xoid/blob/master/website/../docs/recipes/dynamic-functions-with-fixed-references.md",version:"current",lastUpdatedAt:1645382837,sidebar:"docs",previous:{title:"Working with nested state",permalink:"/docs/recipes/nested-state"},next:{title:"Using reducers",permalink:"/docs/recipes/using-reducers"}},u=[{value:"Quick Example",id:"quick-example",children:[]},{value:"Another Example",id:"another-example",children:[]}],l={rightToc:u};function s(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"Inside a React function component, in some cases which will be explained below, ",Object(i.b)("strong",{parentName:"p"},"a function with a fixed reference, but a dynamic content")," may be needed. While this is not as straightforward with React hooks, it's trivial with ",Object(i.b)("strong",{parentName:"p"},"xoid"),"."),Object(i.b)("h3",{id:"quick-example"},"Quick Example"),Object(i.b)("p",null,"Let's imagine, we have the following ",Object(i.b)("inlineCode",{parentName:"p"},"React.useEffect"),". Inside it, an event listener is attached and removed everytime when ",Object(i.b)("inlineCode",{parentName:"p"},"props.number")," changes."),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"//inside React\nuseEffect(() => {\n  const callback = () => console.log(props.number)\n  window.addEventListener('click', callback)\n  return () => window.removeEventListener('click', callback)\n}, [props.number])\n")),Object(i.b)("p",null,"Let's assume that, due to changed app requirements, we want to attach the listener only once, and remove it once the component is unmounted. This can be achieved in React way as the following:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"//inside React\nconst numberRef = useRef(props.number)\nuseEffect(() => (numberRef.current = props.number), [props.number])\n\nuseEffect(() => {\n  const callback = () => console.log(numberRef.current)\n  window.addEventListener('click', callback)\n  return () => window.removeEventListener('click', callback)\n}, [])\n")),Object(i.b)("p",null,"Let's articulate what just happened here. The ",Object(i.b)("inlineCode",{parentName:"p"},"useEffect")," is converted run only once during the component lifecycle, so it has zero dependencies. Above that ",Object(i.b)("inlineCode",{parentName:"p"},"useEffect"),", to get the most recent version of the ",Object(i.b)("inlineCode",{parentName:"p"},"number")," prop each time the callback runs, a mechanism was built using two hooks: a ",Object(i.b)("inlineCode",{parentName:"p"},"useRef")," to hold the value and a ",Object(i.b)("inlineCode",{parentName:"p"},"useEffect")," to keep it up to date. This mechanism, the ",Object(i.b)("inlineCode",{parentName:"p"},"useEffect")," & ",Object(i.b)("inlineCode",{parentName:"p"},"useRef")," pair is an unspoken, and somewhat common React pattern."),Object(i.b)("p",null,"With ",Object(i.b)("strong",{parentName:"p"},"xoid"),", the equivalent optimization is simply the following:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// inside React\nuseSetup(($props, onCleanup) => {\n  const callback = () => console.log($props().number)\n  window.addEventListener('click', callback)\n  onCleanup(() => window.removeEventListener('click', callback))\n}, props)\n")),Object(i.b)("p",null,"Second argument of ",Object(i.b)("inlineCode",{parentName:"p"},"useSetup")," is a means of communicaton with the outside, which is the component scope. ",Object(i.b)("inlineCode",{parentName:"p"},"useSetup"),"'s closure runs only once, yet we can always reach the latest version of ",Object(i.b)("inlineCode",{parentName:"p"},"number")," without having to setup a DIY ",Object(i.b)("inlineCode",{parentName:"p"},"useRef")," & ",Object(i.b)("inlineCode",{parentName:"p"},"useEffect")," pair. After getting used to, ",Object(i.b)("strong",{parentName:"p"},"xoid")," can feel more intuitive than React hooks in a lot of cases."),Object(i.b)("h3",{id:"another-example"},"Another Example"),Object(i.b)("p",null,"Let's propose another problem, this time let's examine it in a more concrete scenario."),Object(i.b)("p",null,"Let's imagine, inside a React component, we're supposed to initialize a class called ",Object(i.b)("inlineCode",{parentName:"p"},"DragDropLibrary")," ",Object(i.b)("strong",{parentName:"p"},"only once")," as ",Object(i.b)("inlineCode",{parentName:"p"},"new DragDropLibrary({ onDrop })"),". Let's assume we have only one chance to supply ",Object(i.b)("inlineCode",{parentName:"p"},"onDrop"),' to the class instance, and this function cannot ve replaced afterwards. The library was not implemented by us, and we have no interest in modifying it to have dynamic options. So, we want to perform dynamic "onDrop" actions, with the initial version of ',Object(i.b)("inlineCode",{parentName:"p"},"onDrop")," that's supplied."),Object(i.b)("p",null,"Imagine that ",Object(i.b)("inlineCode",{parentName:"p"},"props.func"),' is our dynamic function that changes in every render. We\'re going to use it as the source for different "onDrop" actions.'),Object(i.b)("p",null,"Therefore, we need to convert ",Object(i.b)("inlineCode",{parentName:"p"},"props.func")," (dynamic reference) into ",Object(i.b)("inlineCode",{parentName:"p"},"onDrop")," (fixed reference, dynamic content)."),Object(i.b)("p",null,"With React hooks, it's achieved by combination of three hooks. "),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const onDropRef = useRef((...args) => props.func(...args))\nuseEffect(() => { onDropRef.current = (...args) => props.func(...args) }, [props.func])\nconst onDrop = onDropRef.current \n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},'The "unspoken" ',Object(i.b)("inlineCode",{parentName:"li"},"useRef")," & ",Object(i.b)("inlineCode",{parentName:"li"},"useEffect")," pair"),Object(i.b)("li",{parentName:"ul"},"Finally a ",Object(i.b)("inlineCode",{parentName:"li"},"const onDrop = onDropRef.current")," line")),Object(i.b)("p",null,"What if I told you, with ",Object(i.b)("strong",{parentName:"p"},"xoid"),", it's simply:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// inside React\nconst onDrop = useSetup((atom) => (...args) => atom()(...args), props.func)\n")),Object(i.b)("p",null,"Inside the ",Object(i.b)("inlineCode",{parentName:"p"},"useSetup")," callback, ",Object(i.b)("inlineCode",{parentName:"p"},"atom()"),' simply means "latest version of the dependency". ',Object(i.b)("inlineCode",{parentName:"p"},"ref.current"),' as a "latest version" has a more indirect feeling, and requires more code to set up.'))}s.isMDXComponent=!0},94:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return d}));var r=t(0),o=t.n(r);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=o.a.createContext({}),s=function(e){var n=o.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},p=function(e){var n=s(e.components);return o.a.createElement(l.Provider,{value:n},e.children)},f={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},b=o.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,a=e.parentName,l=u(e,["components","mdxType","originalType","parentName"]),p=s(t),b=r,d=p["".concat(a,".").concat(b)]||p[b]||f[b]||i;return t?o.a.createElement(d,c(c({ref:n},l),{},{components:t})):o.a.createElement(d,c({ref:n},l))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,a=new Array(i);a[0]=b;var c={};for(var u in n)hasOwnProperty.call(n,u)&&(c[u]=n[u]);c.originalType=e,c.mdxType="string"==typeof e?e:r,a[1]=c;for(var l=2;l<i;l++)a[l]=t[l];return o.a.createElement.apply(null,a)}return o.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"},95:function(e,n,t){"use strict";e.exports=t(96)},96:function(e,n,t){"use strict";var r=t(97),o="function"==typeof Symbol&&Symbol.for,i=o?Symbol.for("react.element"):60103,a=o?Symbol.for("react.portal"):60106,c=o?Symbol.for("react.fragment"):60107,u=o?Symbol.for("react.strict_mode"):60108,l=o?Symbol.for("react.profiler"):60114,s=o?Symbol.for("react.provider"):60109,p=o?Symbol.for("react.context"):60110,f=o?Symbol.for("react.forward_ref"):60112,b=o?Symbol.for("react.suspense"):60113,d=o?Symbol.for("react.memo"):60115,m=o?Symbol.for("react.lazy"):60116,h="function"==typeof Symbol&&Symbol.iterator;function y(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,t=1;t<arguments.length;t++)n+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var O={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j={};function v(e,n,t){this.props=e,this.context=n,this.refs=j,this.updater=t||O}function w(){}function g(e,n,t){this.props=e,this.context=n,this.refs=j,this.updater=t||O}v.prototype.isReactComponent={},v.prototype.setState=function(e,n){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(y(85));this.updater.enqueueSetState(this,e,n,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=v.prototype;var k=g.prototype=new w;k.constructor=g,r(k,v.prototype),k.isPureReactComponent=!0;var x={current:null},C=Object.prototype.hasOwnProperty,E={key:!0,ref:!0,__self:!0,__source:!0};function N(e,n,t){var r,o={},a=null,c=null;if(null!=n)for(r in void 0!==n.ref&&(c=n.ref),void 0!==n.key&&(a=""+n.key),n)C.call(n,r)&&!E.hasOwnProperty(r)&&(o[r]=n[r]);var u=arguments.length-2;if(1===u)o.children=t;else if(1<u){for(var l=Array(u),s=0;s<u;s++)l[s]=arguments[s+2];o.children=l}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===o[r]&&(o[r]=u[r]);return{$$typeof:i,type:e,key:a,ref:c,props:o,_owner:x.current}}function R(e){return"object"==typeof e&&null!==e&&e.$$typeof===i}var S=/\/+/g,P=[];function D(e,n,t,r){if(P.length){var o=P.pop();return o.result=e,o.keyPrefix=n,o.func=t,o.context=r,o.count=0,o}return{result:e,keyPrefix:n,func:t,context:r,count:0}}function _(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>P.length&&P.push(e)}function $(e,n,t,r){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var c=!1;if(null===e)c=!0;else switch(o){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case i:case a:c=!0}}if(c)return t(r,e,""===n?"."+T(e,0):n),1;if(c=0,n=""===n?".":n+":",Array.isArray(e))for(var u=0;u<e.length;u++){var l=n+T(o=e[u],u);c+=$(o,l,t,r)}else if(null===e||"object"!=typeof e?l=null:l="function"==typeof(l=h&&e[h]||e["@@iterator"])?l:null,"function"==typeof l)for(e=l.call(e),u=0;!(o=e.next()).done;)c+=$(o=o.value,l=n+T(o,u++),t,r);else if("object"===o)throw t=""+e,Error(y(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t,""));return c}function L(e,n,t){return null==e?0:$(e,"",n,t)}function T(e,n){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var n={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return n[e]}))}(e.key):n.toString(36)}function I(e,n){e.func.call(e.context,n,e.count++)}function A(e,n,t){var r=e.result,o=e.keyPrefix;e=e.func.call(e.context,n,e.count++),Array.isArray(e)?q(e,r,t,(function(e){return e})):null!=e&&(R(e)&&(e=function(e,n){return{$$typeof:i,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}(e,o+(!e.key||n&&n.key===e.key?"":(""+e.key).replace(S,"$&/")+"/")+t)),r.push(e))}function q(e,n,t,r,o){var i="";null!=t&&(i=(""+t).replace(S,"$&/")+"/"),L(e,A,n=D(n,i,r,o)),_(n)}var U={current:null};function M(){var e=U.current;if(null===e)throw Error(y(321));return e}var W={ReactCurrentDispatcher:U,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:x,IsSomeRendererActing:{current:!1},assign:r};n.Children={map:function(e,n,t){if(null==e)return e;var r=[];return q(e,r,null,n,t),r},forEach:function(e,n,t){if(null==e)return e;L(e,I,n=D(null,null,n,t)),_(n)},count:function(e){return L(e,(function(){return null}),null)},toArray:function(e){var n=[];return q(e,n,null,(function(e){return e})),n},only:function(e){if(!R(e))throw Error(y(143));return e}},n.Component=v,n.Fragment=c,n.Profiler=l,n.PureComponent=g,n.StrictMode=u,n.Suspense=b,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W,n.cloneElement=function(e,n,t){if(null==e)throw Error(y(267,e));var o=r({},e.props),a=e.key,c=e.ref,u=e._owner;if(null!=n){if(void 0!==n.ref&&(c=n.ref,u=x.current),void 0!==n.key&&(a=""+n.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(s in n)C.call(n,s)&&!E.hasOwnProperty(s)&&(o[s]=void 0===n[s]&&void 0!==l?l[s]:n[s])}var s=arguments.length-2;if(1===s)o.children=t;else if(1<s){l=Array(s);for(var p=0;p<s;p++)l[p]=arguments[p+2];o.children=l}return{$$typeof:i,type:e.type,key:a,ref:c,props:o,_owner:u}},n.createContext=function(e,n){return void 0===n&&(n=null),(e={$$typeof:p,_calculateChangedBits:n,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},n.createElement=N,n.createFactory=function(e){var n=N.bind(null,e);return n.type=e,n},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:f,render:e}},n.isValidElement=R,n.lazy=function(e){return{$$typeof:m,_ctor:e,_status:-1,_result:null}},n.memo=function(e,n){return{$$typeof:d,type:e,compare:void 0===n?null:n}},n.useCallback=function(e,n){return M().useCallback(e,n)},n.useContext=function(e,n){return M().useContext(e,n)},n.useDebugValue=function(){},n.useEffect=function(e,n){return M().useEffect(e,n)},n.useImperativeHandle=function(e,n,t){return M().useImperativeHandle(e,n,t)},n.useLayoutEffect=function(e,n){return M().useLayoutEffect(e,n)},n.useMemo=function(e,n){return M().useMemo(e,n)},n.useReducer=function(e,n,t){return M().useReducer(e,n,t)},n.useRef=function(e){return M().useRef(e)},n.useState=function(e){return M().useState(e)},n.version="16.13.1"},97:function(e,n,t){"use strict";var r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function a(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var n={},t=0;t<10;t++)n["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(n).map((function(e){return n[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(o){return!1}}()?Object.assign:function(e,n){for(var t,c,u=a(e),l=1;l<arguments.length;l++){for(var s in t=Object(arguments[l]))o.call(t,s)&&(u[s]=t[s]);if(r){c=r(t);for(var p=0;p<c.length;p++)i.call(t,c[p])&&(u[c[p]]=t[c[p]])}}return u}}}]);